
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../namespace_as_a_service/">
      
      
        <link rel="next" href="../upgrading/">
      
      
      <link rel="icon" href="../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Privileged Access Management - Kubernetes Authentication and SSO - OpenUnison</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#privileged-access-management" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Kubernetes Authentication and SSO - OpenUnison" class="md-header__button md-logo" aria-label="Kubernetes Authentication and SSO - OpenUnison" data-md-component="logo">
      
  <img src="../assets/ts-logo-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kubernetes Authentication and SSO - OpenUnison
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Privileged Access Management
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Kubernetes Authentication and SSO - OpenUnison" class="md-nav__button md-logo" aria-label="Kubernetes Authentication and SSO - OpenUnison" data-md-component="logo">
      
  <img src="../assets/ts-logo-white.png" alt="logo">

    </a>
    Kubernetes Authentication and SSO - OpenUnison
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes Authentication and SSO
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployauth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying The Authentication Portal
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-help/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Help
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../javascript/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customizing OpenUnison with JavaScript
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-sts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes Security Token Service
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubectlplugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubectl Plugin
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi_cluster_sso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi Cluster SSO
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../namespace_as_a_service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Namespace as a Service
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Privileged Access Management
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Privileged Access Management
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#managing-privileged-access-in-the-enterprise" class="md-nav__link">
    <span class="md-ellipsis">
      Managing Privileged Access in the Enterprise
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privileged-access-with-openunison" class="md-nav__link">
    <span class="md-ellipsis">
      Privileged Access with OpenUnison
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privileged Access with OpenUnison">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploying-the-manual-incident-approval" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying the Manual Incident Approval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrating-with-your-incident-management-service" class="md-nav__link">
    <span class="md-ellipsis">
      Integrating with your Incident Management Service
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integrating with your Incident Management Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#break-glass-administrator-access" class="md-nav__link">
    <span class="md-ellipsis">
      Break Glass Administrator Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      What's Next?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../upgrading/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading from 1.0.23 and Earlier
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Applications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Well Known Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/argoworkflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Argo Workflows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/drupal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Drupal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/entraid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EntraID / AzureAD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/gitlab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/grafana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grafana Community Edition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/kiali/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kiali
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/kubeapps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VMware Kubeapps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/openshift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenShift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../applications/vault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hashicorp Vault
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Customization
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Customization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customization/custom_jit_workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customized Just-In-Time Login Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customization/custom_logos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Logos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customization/custom_provisioning_tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Provisioning Tasks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customization/resource_management_sheduling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resource Management and Scheduling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customization/themes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Themes and Colors
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/configuring-openunison/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring OpenUnison Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/custom-sso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom SSO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/customize-naas-onboarding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customizing the NaaS Onboarding Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/kerberos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos Support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/login-portal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Login Portal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/naas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Namespace as a Service Portal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/operational-processes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operational Processes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/ouctl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ouctl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_9" >
        
          
          <label class="md-nav__link" for="__nav_13_9" id="__nav_13_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Apis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_9">
            <span class="md-nav__icon md-icon"></span>
            Apis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/apis/apis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenUnison's APIs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/apis/restful/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenUnison RESTful APIs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_9_3" >
        
          
          <label class="md-nav__link" for="__nav_13_9_3" id="__nav_13_9_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Callworkflow
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_9_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_9_3">
            <span class="md-nav__icon md-icon"></span>
            Callworkflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/apis/callworkflow/callworkflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CallWorkflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_9_4" >
        
          
          <label class="md-nav__link" for="__nav_13_9_4" id="__nav_13_9_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scalejs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_9_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_9_4">
            <span class="md-nav__icon md-icon"></span>
            Scalejs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_9_4_1" >
        
          
          <label class="md-nav__link" for="__nav_13_9_4_1" id="__nav_13_9_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Register
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_13_9_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_9_4_1">
            <span class="md-nav__icon md-icon"></span>
            Register
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/apis/scalejs/register/scalejs-register/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ScaleJS Register
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_10" >
        
          
          <label class="md-nav__link" for="__nav_13_10" id="__nav_13_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Javadocs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_10">
            <span class="md-nav__icon md-icon"></span>
            Javadocs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/javadocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JavaDocs for OpenUnison
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_10_2" >
        
          
          <label class="md-nav__link" for="__nav_13_10_2" id="__nav_13_10_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1.0.42
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_10_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_10_2">
            <span class="md-nav__icon md-icon"></span>
            1.0.42
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_10_2_1" >
        
          
          <label class="md-nav__link" for="__nav_13_10_2_1" id="__nav_13_10_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Legal
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_13_10_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_10_2_1">
            <span class="md-nav__icon md-icon"></span>
            Legal
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/javadocs/1.0.42/legal/dejavufonts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dejavufonts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/javadocs/1.0.42/legal/jquery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jquery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/javadocs/1.0.42/legal/jqueryUI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jqueryUI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_11" >
        
          
          <label class="md-nav__link" for="__nav_13_11" id="__nav_13_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_11">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/reference/authentication-mechanisms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication Mechanisms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/reference/custom-authorizations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Authorizations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/reference/custom-results/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Results
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/reference/custom-tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Provisioning Custom Tasks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/reference/filters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application URL Filters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/reference/jobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scheduled Jobs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/reference/openunison-crds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenUnison Kubernetes CRD Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/reference/operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operator Helm Chart Customization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/reference/provisioning-tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Provisioning Tasks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/reference/targets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Provisioning Targets
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Identity providers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Identity providers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identity%20providers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    List of Documented Identity Providers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identity%20providers/azuread/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EntraID / AzureAD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identity%20providers/keycloak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keycloak
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identity%20providers/okta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Okta
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ingresses
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            Ingresses
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingresses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    List of Documented Ingress Controllers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingresses/f5nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    F5 NGINX Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingresses/istio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Istio Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingresses/nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NGINX Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingresses/traefik/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Traefik
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Knowledgebase
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Knowledgebase
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knowledgebase/airgap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Air-Gap Implementation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knowledgebase/broken_dashboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Broken Dashboard Login
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knowledgebase/certificates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Certificate Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knowledgebase/customizingmyvd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customizing MyVirtualDirectory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knowledgebase/orchestra_deployment_failed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Failed Orchestra Deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knowledgebase/prometheus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring OpenUnison with Prometheus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knowledgebase/sessions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session Management
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#managing-privileged-access-in-the-enterprise" class="md-nav__link">
    <span class="md-ellipsis">
      Managing Privileged Access in the Enterprise
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privileged-access-with-openunison" class="md-nav__link">
    <span class="md-ellipsis">
      Privileged Access with OpenUnison
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privileged Access with OpenUnison">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploying-the-manual-incident-approval" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying the Manual Incident Approval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrating-with-your-incident-management-service" class="md-nav__link">
    <span class="md-ellipsis">
      Integrating with your Incident Management Service
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integrating with your Incident Management Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#break-glass-administrator-access" class="md-nav__link">
    <span class="md-ellipsis">
      Break Glass Administrator Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      What's Next?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="privileged-access-management">Privileged Access Management</h1>
<p>Privileged Access Management, or Zero Standing Privileges, exposes administrator access to a cluster only during approved windows.  The goal of privileged access management is to limit the scope of a breach by ensuring that lost credentials can only be used to compromise a system during limited times.</p>
<p>OpenUnison's built in provisioning, deprovisioning, and scheduling capabilities make it an ideal system for managing privileged access in your Kubernetes clusters.  Before diving into the implementation specifics, let's cover an overview of how privileged access typically works.</p>
<h2 id="managing-privileged-access-in-the-enterprise">Managing Privileged Access in the Enterprise</h2>
<p>The below diagram shows a typical enterprise privileged access system.  Access is granted during an "incident", which is logged in an incident management system.  An "incident" doesn't necessarily mean something bad, it can be scheduled maintenance or a rollout of a new system.  The point of an incident management system is to track that the incident has gone through the enterprise's compliance process for approval. </p>
<p>Once an incident is created, the next step is to unlock a credential for the user that's going to do the work.  This is often a separate account that is bound to the user, but they only know the password during approved windows.  The job of unlocking this account and providing the credentials to the user securely is often done by a Privileged Access Manager, or PAM.  At this point the user is able to login to their cluster, in this case with OpenUnison, and do their work.  After logging in to OpenUnison they get a token that maps a group to a Kubernetes <code>ClusterRoleBinding</code> with <code>cluster-admin</code> access.  Once the incident's window is completed, the PAM locks the account.</p>
<p><img alt="Generic privileged access scenario for Kubernetes" src="/assets/images/privileged-access/privileged-access-generic.png" title="Generic Privileged Access Management with Kubernetes" /></p>
<p>This approach works well when you have a single cluster to manage.  What if you have multiple clusters that you could potentially have access to with the same privileged account?  </p>
<p><img alt="Privileged access across multiple Kubernetes clusters" src="/assets/images/privileged-access/privilege-blast-radius.png" title="Privileged access across multiple Kubernetes clusters" /></p>
<p>Once our privileged account is unlocked, it has access to not only the cluster listed in our incident, but also the other clusters I'm responsible for managing.  This leads to both technical and non-technical risks.  The largest non-technical risk is that you've broken your compliance framework because you're allowing privileged access to clusters that aren't part of an incident.  As for technical risks:</p>
<ol>
<li>Lost credentials can be used against against clusters outside of the clusters named in your incident.  While time boxing the incident and credentials helps mitigate this risk, an attacker who has compromised the administrator's workstation could still compromise clusters outside of the incident.</li>
<li>An administrator could accidentally act on a cluster outside the incident.  If their credentials are unlocked across all possible clusters, a mistake could cause impacts to production systems.</li>
</ol>
<p>Managing these risks can be difficult in Kubernetes given the disconnected nature of authorization between a <code>ClusterRoleBinding</code> be stored in-cluster and the group being managed in an identity provider.  We'll next walk through how OpenUnison makes this easier.</p>
<h2 id="privileged-access-with-openunison">Privileged Access with OpenUnison</h2>
<p>OpenUnison simplifies privileged access management in Kubernetes by using it's built in identity management capabilities to:</p>
<ol>
<li>Create a group separate from the identity provider's group for <code>cluster-admin</code> access.</li>
<li>When an incident is approved, a workflow adds the appropriate user to the correct group in a way that can be tracked both via SQL queries and inside of the SIEM tracking OpenUnison's logs, allowing the user to access the appropriate cluster.</li>
<li>When the incident is over, the user's access is removed and their sessions are destroyed, forcing them to re-login.</li>
<li>If it's found a user has access, but doesn't have a corresponding incident, then their access is removed and their sessions destroyed, requiring them to re-login.</li>
</ol>
<p>The difficult part in automating this process is how to determine if there is an incident, which clusters the incident applies to, and how long the incident should last.  This is tough because incident management is generally a business process that is managed outside of standard Kubernetes workflows.  It will be unique to each enterprise. </p>
<p>To make it easier to integrate OpenUnison with your incident management system, we've given you multiple options for triggering an incident:</p>
<ul>
<li>
<p><strong><em>Manual Incident Approval</em></strong> - Instead of hooking your OpenUnison into an incident management system, you can specify the information manually and provide a list of approvers.  This provides the least amount of automation and integration, but allows you to get started quickly.</p>
</li>
<li>
<p><strong><em>Integrated</em></strong> - Almost anything in OpenUnison can be customized using JavaScript.  OpenUnison will provide you the base line and the form, as well as the area to create the customization needed to connect to your incident management system.  All of the boilerplate and identity work is done for you, you just need to provide the incident information.</p>
</li>
</ul>
<p>Next, we'll walk through deploying both options.</p>
<h3 id="deploying-the-manual-incident-approval">Deploying the Manual Incident Approval</h3>
<p>If a user is an authorized cluster administrator, the manual incident approval mode deploys a form that asks for:</p>
<ol>
<li><strong><em>Cluster</em></strong> - One of any of the clusters the user is already authorized to be a <code>cluster-admin</code> in.</li>
<li><strong><em>Window expiration for the incident</em></strong> - When the user's privileged access is set to expire.</li>
<li><strong><em>An incident name or number</em></strong> - The name or the label of your incident that an approver can track back to the incident management system.</li>
<li><strong><em>A task name or number</em></strong>  - A task that can be tracked back to the incident management system.</li>
</ol>
<p><img alt="Manual authorization privileged access form" src="/assets/images/privileged-access/manual-az-1.png" /></p>
<p>Once submitted, a list of approvers will get the change to review and approve the access request.  While this won't integrate with your existing workflow and relies on the approvers responding in a timely manner, it can get you running quickly.</p>
<p>The first step is to run <a href="/namespace_as_a_service/">OpenUnison NaaS deployment</a>.  You don't need to run a full OpenUnison NaaS per cluster, you can integrate multiple clusters into a control plane to simplify rollout.</p>
<p>Once the NaaS is deployed, the next step is to make some updates to OpenUnison's values.yaml.  The first is to set <code>openunison.naas.groups.privilegedAccessGroup</code> to <code>k8s-cluster-k8s-privileged-internal</code>.  This tells OpenUnison not to create a <code>ClusterRoleBinding</code> for the cluster's administrator groups (internal or external).  </p>
<p>The next setting is to tell OpenUnison how to populate the form.  Add the following under <code>openunison.naas.forms</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">openunison</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="nt">naas</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="nt">forms</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">      </span><span class="nt">privileged_access</span><span class="p">:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">        </span><span class="c1"># needed for additional javascdript in the OpenUnison frontend</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">        </span><span class="nt">includeExtraJs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">        </span><span class="c1"># Should be false unless testing an integration</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">        </span><span class="nt">test_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">        </span><span class="c1"># The name of the attribute that identifies users, should only be changed if your LDAP directory is configured for a different lookup attribute</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">        </span><span class="nt">uid_attribute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uid</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">        </span><span class="c1"># configuration specific to the manual approval process</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">        </span><span class="nt">manual_approval</span><span class="p">:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">          </span><span class="c1"># true if you want to use manual approvals</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">          </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">          </span><span class="c1"># a list of OpenUnison groups (not from your identity provider)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">          </span><span class="nt">groups</span><span class="p">:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">priv-approval-internal</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">priv-approval-external</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">        </span><span class="c1"># minimal js needed to tell OpenUnison about the incident</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">        </span><span class="nt">submission_javascript</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">          </span><span class="no">function validate_submission(newUser, errors, userData) {</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">            </span><span class="no">// create an object that represents an incident</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">            </span><span class="no">var incident = {</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">              </span><span class="no">&quot;id&quot;: newUser.getAttributes().get(&quot;incident&quot;),</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">              </span><span class="no">&quot;task&quot;: newUser.getAttributes().get(&quot;taskid&quot;),</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="w">              </span><span class="no">&quot;expires&quot;: newUser.getAttributes().get(&quot;expiry&quot;)</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">            </span><span class="no">};</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="w">            </span><span class="no">// serialize the data to a string, store in the globals map</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="w">            </span><span class="no">globals.put(&quot;incident_info&quot;,JSON.stringify(incident));</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="w">            </span><span class="no">// no errors, return null</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="w">            </span><span class="no">return null;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="w">          </span><span class="no">}</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">        </span><span class="c1"># list of attributes to display on the form</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="w">        </span><span class="nt">additional_attributes</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">expiry</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="w">          </span><span class="nt">displayName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Window Expiration (YYYY-MM-DDTHH:MMZ)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="w">          </span><span class="nt">regEx</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;^\\\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\\\\d|3[01])T([01]\\\\d|2[0-3]):[0-5]\\\\d(Z|[+-]([01]\\\\d|2[0-3]):[0-5]\\\\d)$&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="w">          </span><span class="nt">regExFailedMsg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">correct</span><span class="nv"> </span><span class="s">format&quot;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="w">          </span><span class="nt">minChars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="w">          </span><span class="nt">maxChars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="w">          </span><span class="nt">unique</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">incident</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="w">          </span><span class="nt">displayName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Incident</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="w">          </span><span class="nt">regEx</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.*&quot;</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="w">          </span><span class="nt">minChars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="w">          </span><span class="nt">maxChars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">taskid</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="w">          </span><span class="nt">displayName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Task</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="w">          </span><span class="nt">regEx</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.*&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="w">          </span><span class="nt">minChars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="w">          </span><span class="nt">maxChars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</code></pre></div>
<p>For manual authorization, these fields shouldn't be changed much.  <code>displayName</code> for each attribute.  Beyond that, OpenUnison won't have the information it will need in order to properly authorize the user and add them to the correct group.</p>
<p>Once your values.yaml is updated, the last step is to redeploy OpenUnison, with the additional <code>openunison-privileged-access</code> chart.  If you're deploying manually or with Argo CD, you'll need to force a full-rollout, not just installing the additional chart to ensure that the <code>ClusterRoleBinding</code> is correctly set to only allow access to users who have been authorized.  If you're using the <code>ouctl</code> utility, you can use <code>-r</code> to add additional charts:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>ouctl<span class="w"> </span>install-auth-portal<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;openunison-privileged-access=tremolo/openunison-privileged-access&#39;</span><span class="w"> </span>/path/to/values.yaml
</code></pre></div>
<p>With manual authorization deployed, you can get a feel for how privileged access can be automated.  Once you're ready, the next step will be to integrate privileged access with your incident management system.</p>
<h3 id="integrating-with-your-incident-management-service">Integrating with your Incident Management Service</h3>
<p>Having looked at the manual approval process, next we can integrate OpenUnison with our incident management service.  This part is going to be different for every each enterprise and organization.  It will probably always rhyme, but differences in process, products, etc will mean that this is going to change based on your organization.  </p>
<p>In order to setup our privileged session we'll need to collect the incident, task, and expiration from our incident management service.  As an example, we're going to create a simple service that takes the cluster, incident, and user to return a list of possible tasks and an expiration.  We're going to use a <a href="https://github.com/OpenUnison/privileged-access-service">Python based service we published</a> as an easy starting point.  Once you create the container, you can deploy it using our pre-built yaml.  Update the image to wherever you pushed your image to.  Once it's running, you can exec into a <code>Pod</code> in the openunison namespace and get a task with the url <code>http://pamapi.openunison.svc/verify-access?user_id=user&amp;cluster_id=k8s&amp;ticket_number=inc1234567</code> and get the response:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;pamTasks&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">      </span><span class="nt">&quot;expiryTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-03T19:06:02+00:00&quot;</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">      </span><span class="nt">&quot;pamTaskID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TASK-1234&quot;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="p">}</span>
</code></pre></div>
<p>This isn't very useful in real life, but we'll use it to illustrate how to integrate our enterprise's incident management system into OpenUnison.  We're going to pull this data into OpenUnison from the same privileged access form we did before, but instead of manually specifying the task and expiration, we're going to specify a cluster and incident number, and let our service provide the rest.  When we're done, our form will look like:</p>
<p><img alt="Integrated authorization privileged access form" src="/assets/images/privileged-access/integrated-1.png" /></p>
<p>When an authorized user is presented with the form, they enter their incident number and click "LOOKUP" to trigger the call to the incident lookup service.  Once tasks are returned the <strong>Task</strong> drop down box is populated with a list of available tasks and when they expire.  The privileged user is able to choose the task they want their sessions to be associated with and once they submit, they immediately are granted the administrator access without waiting for any outside approvals.</p>
<p>The first step to making this happen is to create a <code>ConfigMap</code> with some javascript that will be used by OpenUnison's front end to interact with our web service.  OpenUnison's frontend is built on react, so our additional function will also need to be built on react.  This is the function that will be called when the user hits the "LOOKUP" button, but since it runs on the client, we'll also need to implement an API in OpenUnison to call our service.  Both the <a href="https://raw.githubusercontent.com/OpenUnison/privileged-access-service/refs/heads/main/src/kubernetes/register-extra-functions.yaml"><code>ConfigMap</code> and the OpenUnison <code>Application</code></a> are in the same project as our service.  We won't walk through the configuration here, but we've commented the code for you.</p>
<p>With the code deployed for our front end integration, we can update our values.yaml.  First, we need to configure OpenUnison to load the <code>ConfigMap</code> with our front end code in it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nt">openunison</span><span class="p">:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">html</span><span class="p">:</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="nt">registerFunctionsConfigMap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scalejs-functions</span>
</code></pre></div>
<p>This tells OpenUnison to attach the <code>scalejs-functions</code> <code>ConfigMap</code> to the <code>ouhtml-orchestra-login-portal</code> <code>Deployment</code> so it can be served to the user's browser.  Next, we'll start configuring our privileged access request form.  Replace your <code>openunison.naas.forms.privileged_access</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nt">openunison</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">naas</span><span class="p">:</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="nt">forms</span><span class="p">:</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">      </span><span class="nt">privileged_access</span><span class="p">:</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">        </span><span class="nt">includeExtraJs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">        </span><span class="nt">test_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">        </span><span class="nt">uid_attribute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uid</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span><span class="nt">manual_approval</span><span class="p">:</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">          </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">        </span><span class="nt">submission_javascript</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">          </span><span class="no">function validate_submission(newUser, errors, userData) {</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">            </span><span class="no">// pull data out of the selected task</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">            </span><span class="no">task = newUser.getAttributes().get(&quot;task&quot;);</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">            </span><span class="no">taskJson = JSON.parse(task);</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">            </span><span class="no">taskid = taskJson.pamTaskID;</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">            </span><span class="no">expiry = taskJson.expiryTime;</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">            </span><span class="no">// create an object that represents an incident</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">            </span><span class="no">var incident = {</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">              </span><span class="no">&quot;id&quot;: newUser.getAttributes().get(&quot;incident&quot;),</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">              </span><span class="no">&quot;task&quot;: taskid,</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">              </span><span class="no">&quot;expires&quot;: expiry</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">            </span><span class="no">};</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">            </span><span class="no">// serialize the data to a string, store in the globals map</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">            </span><span class="no">globals.put(&quot;incident_info&quot;,JSON.stringify(incident));</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">            </span><span class="no">// no errors, return null</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">            </span><span class="no">return null;</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">          </span><span class="no">}</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">        </span><span class="nt">additional_attributes</span><span class="p">:</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">incident</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text-button</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">          </span><span class="nt">displayName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Indident / Change</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">          </span><span class="nt">regEx</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;^[iI][nN][cC]\\\\d{7,8}$|^[cC][hH][gG]\\\\d{7,8}$&quot;</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">          </span><span class="nt">regExFailedMsg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Incidents</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">form</span><span class="nv"> </span><span class="s">INC1111111</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">CHG1111111&quot;</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">          </span><span class="nt">minChars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">          </span><span class="nt">maxChars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="w">          </span><span class="nt">unique</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">          </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="w">          </span><span class="nt">editJavaScriptFunction</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;react_load_tasks(eventObj)&quot;</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">task</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">list</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="w">          </span><span class="nt">displayName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Task</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="w">          </span><span class="nt">regEx</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.*&quot;</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="w">          </span><span class="nt">minChars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="w">          </span><span class="nt">maxChars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="w">          </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="w">          </span><span class="nt">dynamicValueSource</span><span class="p">:</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="w">            </span><span class="nt">className</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">com.tremolosecurity.scalejs.register.dynamicSource.JavaScriptSource</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a><span class="w">            </span><span class="nt">config</span><span class="p">:</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="w">              </span><span class="nt">javaScript</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GlobalEntries</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;com.tremolosecurity.server.GlobalEntries&#39;);</span><span class="nv"> </span><span class="s">HashMap</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;java.util.HashMap&#39;);</span><span class="nv"> </span><span class="s">BasicHttpClientConnectionManager</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;org.apache.http.impl.conn.BasicHttpClientConnectionManager&#39;);</span><span class="nv"> </span><span class="s">RequestConfig</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;org.apache.http.client.config.RequestConfig&#39;);</span><span class="nv"> </span><span class="s">CookieSpecs</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;org.apache.http.client.config.CookieSpecs&#39;);</span><span class="nv"> </span><span class="s">HttpClients</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;org.apache.http.impl.client.HttpClients&#39;);</span><span class="nv"> </span><span class="s">HttpGet</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;org.apache.http.client.methods.HttpGet&#39;);</span><span class="nv"> </span><span class="s">EntityUtils</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;org.apache.http.util.EntityUtils&#39;);</span><span class="nv"> </span><span class="s">ProxyConstants</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;com.tremolosecurity.proxy.util.ProxyConstants&#39;);</span><span class="nv"> </span><span class="s">ProxySys</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;com.tremolosecurity.proxy.ProxySys&#39;);</span><span class="nv"> </span><span class="s">JSUtils</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;com.tremolosecurity.util.JSUtils&#39;);</span><span class="nv"> </span><span class="s">BasicHeader</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;org.apache.http.message.BasicHeader&#39;);</span><span class="nv"> </span><span class="s">UUID</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;java.util.UUID&#39;);</span><span class="nv"> </span><span class="s">function</span><span class="nv"> </span><span class="s">init(attribute,config)</span><span class="nv"> </span><span class="s">{}</span><span class="nv"> </span><span class="s">function</span><span class="nv"> </span><span class="s">getSourceList(request)</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">ArrayList</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;java.util.ArrayList&#39;);</span><span class="nv"> </span><span class="s">return</span><span class="nv"> </span><span class="s">new</span><span class="nv"> </span><span class="s">ArrayList();</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">function</span><span class="nv"> </span><span class="s">validate(value,request){</span><span class="nv"> </span><span class="s">System</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">Java.type(&#39;java.lang.System&#39;);</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">sessionId</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">request.getSession().getAttribute(&#39;tremolo.io/priv-session-id&#39;);</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">(sessionId</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">null)</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">sessionId</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">UUID.randomUUID().toString();</span><span class="nv"> </span><span class="s">request.getSession().setAttribute(&#39;tremolo.io/priv-session-id&#39;,sessionId);</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">userData</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">(request.getSession().getAttribute(ProxyConstants.AUTH_CTL)).getAuthInfo();</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">payload</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">JSUtils.bytes2string(request.getAttribute(ProxySys.MSG_BODY));</span><span class="nv"> </span><span class="s">System.out.println(&#39;payload:</span><span class="nv"> </span><span class="s">&#39;</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">payload);</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">payloadJson</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">JSON.parse(payload);</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">incident</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">payloadJson.attributes.incident;</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">cluster</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">payloadJson.attributes.cluster;</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">bhcm</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">new</span><span class="nv"> </span><span class="s">BasicHttpClientConnectionManager(GlobalEntries.getGlobalEntries().getConfigManager().getHttpClientSocketRegistry());</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">rc</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">RequestConfig.custom().setCookieSpec(CookieSpecs.STANDARD).setRedirectsEnabled(false).build();</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">http</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">HttpClients.custom().setConnectionManager(bhcm).setDefaultRequestConfig(rc).build();</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">taskData</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">JSON.parse(value);</span><span class="nv"> </span><span class="s">try</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">get</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">new</span><span class="nv"> </span><span class="s">HttpGet(&#39;http://pamapi.openunison.svc/verify-access?user_id=&#39;</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">userData.getAttribs().get(&#39;sub&#39;).getValues().get(0)</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">&#39;&amp;cluster_id=&#39;</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">cluster</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">&#39;&amp;ticket_number=&#39;</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">incident);</span><span class="nv"> </span><span class="s">get.addHeader(new</span><span class="nv"> </span><span class="s">BasicHeader(&#39;tremoloio-request-type&#39;,&#39;verify&#39;));</span><span class="nv"> </span><span class="s">get.addHeader(new</span><span class="nv"> </span><span class="s">BasicHeader(&#39;tremoloio-priv-session-id&#39;,sessionId));</span><span class="nv"> </span><span class="s">svcResp</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">http.execute(get);</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">(svcResp.getStatusLine().getStatusCode()</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">200)</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">respPayload</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">EntityUtils.toString(svcResp.getEntity());</span><span class="nv"> </span><span class="s">tasks</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">JSON.parse(respPayload);</span><span class="nv"> </span><span class="s">var</span><span class="nv"> </span><span class="s">found</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">false;</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">(var</span><span class="nv"> </span><span class="s">i=0;i&lt;tasks.pamTasks.length;i++)</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">(tasks.pamTasks[i].pamTaskID</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">taskData.pamTaskID)</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">found</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">true;</span><span class="nv"> </span><span class="s">break;</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">(!</span><span class="nv"> </span><span class="s">found)</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">return</span><span class="nv"> </span><span class="s">&#39;Incident</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">task</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">associated&#39;;</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">else</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">return</span><span class="nv"> </span><span class="s">&#39;Unable</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">validate</span><span class="nv"> </span><span class="s">incident</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">task&#39;;</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">finally</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">(http)</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">http.close();</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">(bhcm)</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">bhcm.close();</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">return</span><span class="nv"> </span><span class="s">null;</span><span class="nv"> </span><span class="s">}&quot;</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="w">                </span><span class="c1"># Pre-minified code</span>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="w">                </span><span class="c1"># GlobalEntries = Java.type(&quot;com.tremolosecurity.server.GlobalEntries&quot;);</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="w">                </span><span class="c1"># HashMap = Java.type(&quot;java.util.HashMap&quot;);</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a><span class="w">                </span><span class="c1"># BasicHttpClientConnectionManager = Java.type(&quot;org.apache.http.impl.conn.BasicHttpClientConnectionManager&quot;);</span>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a><span class="w">                </span><span class="c1"># RequestConfig = Java.type(&quot;org.apache.http.client.config.RequestConfig&quot;);</span>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a><span class="w">                </span><span class="c1"># CookieSpecs = Java.type(&quot;org.apache.http.client.config.CookieSpecs&quot;);</span>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="w">                </span><span class="c1"># HttpClients = Java.type(&quot;org.apache.http.impl.client.HttpClients&quot;);</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a><span class="w">                </span><span class="c1"># HttpGet = Java.type(&quot;org.apache.http.client.methods.HttpGet&quot;);</span>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a><span class="w">                </span><span class="c1"># EntityUtils = Java.type(&quot;org.apache.http.util.EntityUtils&quot;);</span>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a><span class="w">                </span><span class="c1"># ProxyConstants = Java.type(&quot;com.tremolosecurity.proxy.util.ProxyConstants&quot;);</span>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="w">                </span><span class="c1"># ProxySys = Java.type(&quot;com.tremolosecurity.proxy.ProxySys&quot;);</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a><span class="w">                </span><span class="c1"># JSUtils = Java.type(&quot;com.tremolosecurity.util.JSUtils&quot;);</span>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a><span class="w">                </span><span class="c1"># BasicHeader = Java.type(&quot;org.apache.http.message.BasicHeader&quot;);</span>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a><span class="w">                </span><span class="c1"># UUID = Java.type(&quot;java.util.UUID&quot;);</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a><span class="w">                </span><span class="c1"># function init(attribute,config) {</span>
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a>
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a><span class="w">                </span><span class="c1"># }</span>
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a><span class="w">                </span><span class="c1"># // we don&#39;t need to retrieve the list on its own because it will</span>
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a><span class="w">                </span><span class="c1"># // be loaded interactively from the form</span>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a><span class="w">                </span><span class="c1"># function getSourceList(request) {</span>
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a><span class="w">                </span><span class="c1">#   ArrayList = Java.type(&#39;java.util.ArrayList&#39;);</span>
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a><span class="w">                </span><span class="c1">#   return new ArrayList();</span>
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a><span class="w">                </span><span class="c1"># }</span>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a>
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a><span class="w">                </span><span class="c1"># // make sure that the window submitted matches for the requested incident</span>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a><span class="w">                </span><span class="c1"># // this is duplicative, but could be avoided by signing the data on response to the frontend</span>
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a><span class="w">                </span><span class="c1"># function validate(value,request){</span>
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a><span class="w">                </span><span class="c1">#   System = Java.type(&quot;java.lang.System&quot;);</span>
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a>
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a><span class="w">                </span><span class="c1">#   //useful for tracking requests</span>
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a><span class="w">                </span><span class="c1">#   var sessionId = request.getSession().getAttribute(&quot;tremolo.io/priv-session-id&quot;);</span>
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a><span class="w">                </span><span class="c1">#   if (sessionId == null) {</span>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a><span class="w">                </span><span class="c1">#     sessionId = UUID.randomUUID().toString();</span>
<a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a><span class="w">                </span><span class="c1">#     request.getSession().setAttribute(&quot;tremolo.io/priv-session-id&quot;,sessionId);</span>
<a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a><span class="w">                </span><span class="c1">#   }</span>
<a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a>
<a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a>
<a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a>
<a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a>
<a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a><span class="w">                </span><span class="c1">#   //get the data from the payload to verify</span>
<a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a><span class="w">                </span><span class="c1">#   userData = (request.getSession().getAttribute(ProxyConstants.AUTH_CTL)).getAuthInfo();</span>
<a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a><span class="w">                </span><span class="c1">#   var payload = JSUtils.bytes2string(request.getAttribute(ProxySys.MSG_BODY));</span>
<a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a><span class="w">                </span><span class="c1">#   System.out.println(&quot;payload: &quot; + payload);</span>
<a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a><span class="w">                </span><span class="c1">#   var payloadJson = JSON.parse(payload);</span>
<a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a><span class="w">                </span><span class="c1">#   var incident = payloadJson.attributes.incident;</span>
<a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a><span class="w">                </span><span class="c1">#   var cluster = payloadJson.attributes.cluster;</span>
<a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a>
<a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a><span class="w">                </span><span class="c1">#   // create an http connection to our service.  there&#39;s no authentication, but for a production system this</span>
<a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a><span class="w">                </span><span class="c1">#   // would be a good place to include an authentication token</span>
<a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a><span class="w">                </span><span class="c1">#   var bhcm = new BasicHttpClientConnectionManager(GlobalEntries.getGlobalEntries().getConfigManager().getHttpClientSocketRegistry());</span>
<a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a><span class="w">                </span><span class="c1">#   var rc = RequestConfig.custom().setCookieSpec(CookieSpecs.STANDARD).setRedirectsEnabled(false).build();</span>
<a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a><span class="w">                </span><span class="c1">#   var http = HttpClients.custom().setConnectionManager(bhcm).setDefaultRequestConfig(rc).build();</span>
<a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a>
<a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a><span class="w">                </span><span class="c1">#   var taskData = JSON.parse(value);</span>
<a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a>
<a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a><span class="w">                </span><span class="c1">#   try {</span>
<a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a><span class="w">                </span><span class="c1">#     // call our service</span>
<a id="__codelineno-4-115" name="__codelineno-4-115" href="#__codelineno-4-115"></a><span class="w">                </span><span class="c1">#     var get = new HttpGet(&quot;http://pamapi.openunison.svc/verify-access?user_id=&quot; + userData.getAttribs().get(&quot;sub&quot;).getValues().get(0) + &quot;&amp;cluster_id=&#39; + cluster + &#39;&amp;ticket_number=&quot; + incident);</span>
<a id="__codelineno-4-116" name="__codelineno-4-116" href="#__codelineno-4-116"></a>
<a id="__codelineno-4-117" name="__codelineno-4-117" href="#__codelineno-4-117"></a><span class="w">                </span><span class="c1">#     // useful for tracking requests</span>
<a id="__codelineno-4-118" name="__codelineno-4-118" href="#__codelineno-4-118"></a><span class="w">                </span><span class="c1">#     get.addHeader(new BasicHeader(&quot;tremoloio-request-type&quot;,&quot;verify&quot;));</span>
<a id="__codelineno-4-119" name="__codelineno-4-119" href="#__codelineno-4-119"></a><span class="w">                </span><span class="c1">#     get.addHeader(new BasicHeader(&quot;tremoloio-priv-session-id&quot;,sessionId));</span>
<a id="__codelineno-4-120" name="__codelineno-4-120" href="#__codelineno-4-120"></a>
<a id="__codelineno-4-121" name="__codelineno-4-121" href="#__codelineno-4-121"></a><span class="w">                </span><span class="c1">#     svcResp = http.execute(get);</span>
<a id="__codelineno-4-122" name="__codelineno-4-122" href="#__codelineno-4-122"></a><span class="w">                </span><span class="c1">#     if (svcResp.getStatusLine().getStatusCode() == 200) {</span>
<a id="__codelineno-4-123" name="__codelineno-4-123" href="#__codelineno-4-123"></a><span class="w">                </span><span class="c1">#.      // everything is OK, make sure that the returned task matches what was submitted</span>
<a id="__codelineno-4-124" name="__codelineno-4-124" href="#__codelineno-4-124"></a><span class="w">                </span><span class="c1">#       respPayload = EntityUtils.toString(svcResp.getEntity());</span>
<a id="__codelineno-4-125" name="__codelineno-4-125" href="#__codelineno-4-125"></a><span class="w">                </span><span class="c1">#       tasks = JSON.parse(respPayload);</span>
<a id="__codelineno-4-126" name="__codelineno-4-126" href="#__codelineno-4-126"></a><span class="w">                </span><span class="c1">#       var found = false;</span>
<a id="__codelineno-4-127" name="__codelineno-4-127" href="#__codelineno-4-127"></a><span class="w">                </span><span class="c1">#       for (var i=0;i&lt;tasks.pamTasks.length;i++) {</span>
<a id="__codelineno-4-128" name="__codelineno-4-128" href="#__codelineno-4-128"></a><span class="w">                </span><span class="c1">#         if (tasks.pamTasks[i].pamTaskID == taskData.pamTaskID /*&amp;&amp; tasks.pamTasks[i].expiryTime == taskData.expiryTime*/) {</span>
<a id="__codelineno-4-129" name="__codelineno-4-129" href="#__codelineno-4-129"></a><span class="w">                </span><span class="c1">#           found = true;</span>
<a id="__codelineno-4-130" name="__codelineno-4-130" href="#__codelineno-4-130"></a><span class="w">                </span><span class="c1">#           break;</span>
<a id="__codelineno-4-131" name="__codelineno-4-131" href="#__codelineno-4-131"></a><span class="w">                </span><span class="c1">#         }</span>
<a id="__codelineno-4-132" name="__codelineno-4-132" href="#__codelineno-4-132"></a><span class="w">                </span><span class="c1">#       }</span>
<a id="__codelineno-4-133" name="__codelineno-4-133" href="#__codelineno-4-133"></a>
<a id="__codelineno-4-134" name="__codelineno-4-134" href="#__codelineno-4-134"></a><span class="w">                </span><span class="c1">#.      // there was a problem, return an error</span>
<a id="__codelineno-4-135" name="__codelineno-4-135" href="#__codelineno-4-135"></a><span class="w">                </span><span class="c1">#       if (! found) {</span>
<a id="__codelineno-4-136" name="__codelineno-4-136" href="#__codelineno-4-136"></a><span class="w">                </span><span class="c1">#         return &quot;Incident and task are not associated&quot;;</span>
<a id="__codelineno-4-137" name="__codelineno-4-137" href="#__codelineno-4-137"></a><span class="w">                </span><span class="c1">#       }</span>
<a id="__codelineno-4-138" name="__codelineno-4-138" href="#__codelineno-4-138"></a>
<a id="__codelineno-4-139" name="__codelineno-4-139" href="#__codelineno-4-139"></a><span class="w">                </span><span class="c1">#     } else {</span>
<a id="__codelineno-4-140" name="__codelineno-4-140" href="#__codelineno-4-140"></a><span class="w">                </span><span class="c1">#       return &quot;Unable to validate incident and task&quot;;</span>
<a id="__codelineno-4-141" name="__codelineno-4-141" href="#__codelineno-4-141"></a><span class="w">                </span><span class="c1">#     }</span>
<a id="__codelineno-4-142" name="__codelineno-4-142" href="#__codelineno-4-142"></a><span class="w">                </span><span class="c1">#   } finally {</span>
<a id="__codelineno-4-143" name="__codelineno-4-143" href="#__codelineno-4-143"></a><span class="w">                </span><span class="c1">#     if (http) {</span>
<a id="__codelineno-4-144" name="__codelineno-4-144" href="#__codelineno-4-144"></a><span class="w">                </span><span class="c1">#       http.close();</span>
<a id="__codelineno-4-145" name="__codelineno-4-145" href="#__codelineno-4-145"></a><span class="w">                </span><span class="c1">#     }</span>
<a id="__codelineno-4-146" name="__codelineno-4-146" href="#__codelineno-4-146"></a><span class="w">                </span><span class="c1">#     if (bhcm) {</span>
<a id="__codelineno-4-147" name="__codelineno-4-147" href="#__codelineno-4-147"></a><span class="w">                </span><span class="c1">#       bhcm.close();</span>
<a id="__codelineno-4-148" name="__codelineno-4-148" href="#__codelineno-4-148"></a><span class="w">                </span><span class="c1">#     }</span>
<a id="__codelineno-4-149" name="__codelineno-4-149" href="#__codelineno-4-149"></a><span class="w">                </span><span class="c1">#   }</span>
<a id="__codelineno-4-150" name="__codelineno-4-150" href="#__codelineno-4-150"></a>
<a id="__codelineno-4-151" name="__codelineno-4-151" href="#__codelineno-4-151"></a><span class="w">                </span><span class="c1">#   return null;</span>
<a id="__codelineno-4-152" name="__codelineno-4-152" href="#__codelineno-4-152"></a><span class="w">                </span><span class="c1"># }</span>
</code></pre></div>
<p>There are some important differences from the manual authorization configuration:</p>
<ul>
<li><strong><em>Disable Manual Authorizations</em></strong> - <code>openunison.naas.forms.privileged_access.manual_approval.enabled=false</code> to disable the manual workflow</li>
<li><strong><em>Test Mode Enabled</em></strong> - <code>openunison.naas.forms.privileged_access.test_mode=true</code> allows us to test the integration with our service without triggering a privileged access request.</li>
<li><strong><em>Updates to the submission javascript</em></strong> - We're pulling our expiration data from the loaded task information, instead of directly from fields.</li>
<li><strong><em>Changes to attributes</em></strong> - Instead of asking for expiration data, we configure a lookup for our task and a drop down list.  The validation javascript for the list of tasks needs to be minified (removing <code>\n</code> and changing <code>"</code> --&gt; <code>'</code>).  We included the de-minified version.</li>
</ul>
<p>With our updates made, now we just need to re-run ouctl to deploy our changes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>ouctl<span class="w"> </span>install-auth-portal<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;openunison-privileged-access=tremolo/openunison-privileged-access&#39;</span><span class="w"> </span>/path/to/values.yaml
</code></pre></div>
<p>Now you can login and test your privileged access form.  Once you're satisfied with it and want to enable it for production use, change <code>openunison.naas.forms.privileged_access.test_mode=false</code>.</p>
<p>Now that your service is deployed and integrated with the incident service, what happens if your incident management service isn't available?  We'll cover that scenario next.</p>
<h4 id="break-glass-administrator-access">Break Glass Administrator Access</h4>
<p>What happens if your incident management system isn't available during an outage?  How do you ensure your cluster administrators have access?  OpenUnison includes a workflow that allows for authorized users to create a <code>ClusterRoleBinding</code> in all of the managed clusters to make sure cluster administrators aren't locked out.  This list of users are generally members of the security team and are authorized.  When privileged access is enabled, a <code>ClusterRoleBinding</code> is created in each manage cluster to bind anyone that could be a cluster administrator.  Once the incident management service is back online, break glass can be disabled as well by the same users.  To configure your break glass:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nt">openunison</span><span class="p">:</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">naas</span><span class="p">:</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="nt">forms</span><span class="p">:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">      </span><span class="nt">privileged_access</span><span class="p">:</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">        </span><span class="c1"># this is a group from your enterprise identity provider</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">        </span><span class="nt">external_group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CN=kube-break-glass,CN=Users,DC=ent2k22,DC=tremolo,DC=dev</span>
</code></pre></div>
<p>Redeploy your <code>openunison-privileged-access</code> helm deployment, and now any member of the group configured above can enable break glass mode.  When they login to OpenUnison and click on <em>Request Access</em>, they'll see an option for <em>Break Glass</em> where they can run the enable or disable workflows:</p>
<p><img alt="Break glass workflow" src="/assets/images/privileged-access/break-glass.png" /></p>
<h4 id="whats-next">What's Next?</h4>
<p>Nearly all of OpenUnison can be customized via CRDs and javascript.  Check out our applications section to see examples of how to manage more of your organizations management systems into OpenUnison.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>